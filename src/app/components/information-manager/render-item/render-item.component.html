@if (!li.type) {
    {{ li.label }}
}

@if (li.type) {
    @if (li.type == 'InformationLink') {
        <a [routerLink]="li.routerLink">{{ li.label }}</a>
    }
    @if (li.type == 'InformationHtml') {
        <div [innerHTML]="li.html"></div>
    }
    @if (li.type == 'InformationTable') {
        <div class="table-wrapper">
            <table cTable class="table table-responsive-sm">
                <thead>
                <tr>
                    @for (l of li.labels; track l) {
                        <th>{{ l }}</th>
                    }
                </tr>
                </thead>
                <tbody>
                    @for (row of li.rows; track row) {
                        <tr>
                            @for (data of row; track $index) {
                                <td>{{ data }}</td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    @if (li.type == 'InformationCode') {
        <div [ngStyle]="{'height': codeHeight}">
            <app-editor [readonly]="true" [language]="li.language" [code]="li.code"></app-editor>
        </div>
    }
    @if (li.type == 'InformationProgress') {
        <div class="clearfix">
            <div class="float-left">
                <strong>{{ li.label }}</strong>
            </div>
            <div class="float-right">
                <small class="text-muted">{{ displayProgressValue( li ) }}</small>
            </div>
        </div>
        <div class="progress progress-xs">
            <c-progress height="5">
                <c-progress-bar [color]="getProgressColor(li)" [value]="li.value" [max]="li.max || 100"
                                [animated]="true">{{ li.value }}%
                </c-progress-bar>
            </c-progress>
        </div>
    }
    @if (li.type == 'InformationGraph') {
        <app-graph [data]="li.data" [labels]="li.labels" [colorList]="li.colors" [chartType]="li.graphType"
                   [min]="li.min"
                   [max]="li.max"></app-graph>
    }
    @if (li.type == 'InformationPolyAlg' && li.jsonPolyAlg) {
        <app-alg-viewer [initialPlan]="li.jsonPolyAlg" [planType]="li.planType" [isReadOnly]="true"></app-alg-viewer>
    }
    @if (li.type == 'InformationAction') {
        @if (li.parameters) {
            <div class="form-row">
                @for (p of li.parameters | keyvalue; track trackBy( i, p ); let i = $index) {
                    <c-input-group class="col-md-6 mb-2"
                    >
                        <div cInputGroupText>{{ p.key }}</div>
                        <input cFormControl type="text" [(ngModel)]="li.parameters[p.key]">
                    </c-input-group>
                }
            </div>
        }
        <button cButton color="primary" (click)="executeInformationAction(li)"
                [disabled]="executingInformationAction"
                tooltip="Warning: Not all parameters are set!" placement="auto" triggers=""
                #tooltip="bs-tooltip" (mouseenter)="parameterWarning(li, tooltip)" (mouseleave)="tooltip.hide()">
            @if (executingInformationAction) {
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                ></span>
            }
            {{ li.label }}
        </button>
    }
    @if (li.type === 'InformationDuration') {
        <div class="InformationDuration">
            <div [ngClass]="{'duration': li.isChild || showTotalDuration(li), 'isParent': !li.isChild}">
                @if (showTotalDuration( li )) {
                    <strong>
                        total time: {{ displayTime( li.duration ) }}
                    </strong>
                }
                @if (showTotalDuration( li ) && li.name) {
                    <br>
                }
                @if (li.name) {
                    <span class="durationText" [ngClass]="{'text-danger': li.limit && li.duration > li.limit}">
              {{ li.name }}: {{ displayTime( li.duration ) }}
            </span>
                }
                @if (!li.noProgressBar && li.children && li.children.length > 1) {
                    <div class="progress">
                        @for (c of li.children; track c; let i = $index) {
                            <div
                                    class="progress-bar"
                                    [ngClass]="getDurationColor(i)"
                                    [tooltip]="c.name"
                                    container="body"
                                    [ngStyle]="{width: getProgressWidth(li, c)+'%'}">&nbsp;
                            </div>
                        }
                    </div>
                }
                @for (duration of li.children; track $index) {
                    <div class="duration">
                        @if (showTotalDuration( castDuration( duration ) )) {
                            <strong>
                                total {{ duration.duration }}
                            </strong>
                        }
                        @if (showTotalDuration( castDuration( duration ) ) && duration.name) {
                            <br>
                        }
                        <span class="durationText"
                              [ngClass]="{'text-danger': duration.limit && duration.duration > duration.limit}">
                  {{ duration.name }}: {{ displayTime( duration.duration ) }}
                </span>
                        @if (!duration.noProgressBar && duration.children && duration.children.length > 1) {
                            <div class="progress"
                            >
                                @for (c of duration.children; track c; let i = $index) {
                                    <div
                                            class="progress-bar"
                                            [ngClass]="getDurationColor(i)"
                                            [tooltip]="c.name"
                                            container="body"
                                            [ngStyle]="{width: getProgressWidth(duration, c)+'%'}">&nbsp;
                                    </div>
                                }
                            </div>
                        }
                        @for (d of duration.children; track $index) {
                            <app-render-item [li]="castDuration(d)"></app-render-item>
                        }
                    </div>
                }
            </div>
        </div>
    }
    @if (li.type == 'InformationStacktrace') {
        @if (li.exception) {
            <div class="exception">
                <ng-container *ngTemplateOutlet="exceptionTemplate; context:{e: li.exception, errorMsg: li.error}"></ng-container>
            </div>
        }
    }
    @if (li.type == 'InformationKeyValue') {
        @if (li.keyValuePairs) {
            <div>
                <table cTable class="table-sm table-bordered table-striped mb-0">
                    <tbody>
                        @for (p of li.keyValuePairs | keyvalue; track p.key) {
                            <tr>
                                <td>{{ p.key }}</td>
                                <td>{{ p.value }}</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    }
    @if (li.type == 'InformationText') {
        <p>{{ li.text }}</p>
    }
}


<ng-template #exceptionTemplate let-e="e" let-errorMsg="errorMsg">
    @if (e) {
        <div class="card mb-3 shadow-sm">
            <div class="card-header bg-secondary text-white py-2">
                @if (e.detailMessage || e.message || errorMsg) {
                    <strong class="text-danger ">{{ e.detailMessage || e.message || errorMsg }}</strong>
                } @else {
                    <strong>Exception </strong>
                }
            </div>
            <div class="card-body p-0">
                <ul class="list-group list-group-flush font-monospace small">
                    @for (s of e.stackTrace; track $index) {
                        <li class="list-group-item">
                            <span class="text-secondary">at </span>
                            <span class="fw-bold">{{ s.className }}.{{ s.methodName }}</span>
                            (<span class="text-primary">{{ s.fileName }}:{{ s.lineNumber }}</span>)
                            @if (s.moduleName) {
                                <span class="badge bg-light text-dark ms-2">
                      {{ s.moduleName }} {{ s.moduleVersion || '' }}
                    </span>
                            }
                        </li>
                    }
                </ul>
            </div>
        </div>
        <!-- Cause (recursive) -->
        @if (e.cause) {
            <div class="ms-3 mt-2 border-start ps-3">
                <span class="fw-bold text-muted">Caused by:</span>
                <ng-container *ngTemplateOutlet="exceptionTemplate; context:{e: e.cause, errorMsg: null}"></ng-container>
            </div>
        }
    }
</ng-template>
