<h1 class="mb-3">{{ metadata.name }}</h1>
<c-row class="row">
    <c-col class="col-lg-4 fixed-width">
        <c-card>
            <c-card-header>
                <span class="mb-0">Manage {{ metadata.type.charAt( 0 ).toUpperCase() + metadata.type.slice( 1 ) }}</span>
            </c-card-header>
            <c-card-body>
                @if (metadata.type !== 'directory') {
                    <p>Size: {{ _util.humanFileSize( metadata.size ) }}</p>
                }
                <p>Created: {{ metadata.created  | date: 'yyyy-MM-dd HH:mm:SS' }}</p>
                <p>Last modified: {{ metadata.last_modified  | date: 'yyyy-MM-dd HH:mm:SS' }}</p>
            </c-card-body>
            <c-card-footer class="bg-transparent">
                <div class="pull-right" role="group">
                    <button cButton color="danger" class="me-2" (click)="deleteFile()" (mouseleave)="resetDeleteConfirm()">
                        <i [ngClass]="{'cil-trash': !confirmingDeletion, 'fa fa-warning': confirmingDeletion}"></i>
                    </button>
                    <button cButton color="primary" class="me-2" (click)="renameFileModal.visible = true">Rename</button>
                    @if (metadata.type !== 'directory') {
                        <button cButton color="secondary" class=" me-2"
                                (click)="duplicateFile()">Duplicate
                        </button>
                    }
                    @if (metadata.type !== 'directory') {
                        <button cButton color="secondary" (click)="downloadFile()">
                            <span class="cil-cloud-download"></span>
                        </button>
                    }
                </div>
                <c-row>
                </c-row>
            </c-card-footer>
        </c-card>
    </c-col>
    @if (metadata.type === 'notebook') {
        <c-col class="col-lg-4 fixed-width">
            <c-card>
                <c-card-header>
                    <span class="mb-0">Execution</span>
                </c-card-header>
                <c-card-body>
                    <b>Status: {{ statusText }}</b>
                    <p></p>
                </c-card-body>
                <c-card-footer class="bg-transparent">
                    <div class="pull-right" role="group">
                        <button cButton color="danger" class="me-2" [disabled]="sessions.length === 0"
                                (click)="terminateSessionModal.visible = true">
                            Shut Down
                        </button>
                        @if (sessions.length > 0) {
                            <button cButton variant="outline" color="primary" class="me-2" (click)="connectSessionModal.visible = true"
                            >Connect
                            </button>
                        }
                        <button cButton color="primary" (click)="createKernelModal.visible = true" [disabled]="availableKernels.length === 0">Open</button>
                    </div>
                </c-card-footer>
            </c-card>
        </c-col>
    }
</c-row>

<c-modal #renameFileModal tabindex="-1" role="dialog"
         aria-labelledby="renameFileModal" aria-hidden="true">
    <c-modal-header>
        <h4 class="modal-title">Rename File</h4>
        <button type="button" class="close" (click)="renameFileModal.visible = false" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </c-modal-header>

    <c-modal-body>
        <form [formGroup]="renameFileForm" autocomplete="off" (submit)="renameFile()">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <label for="renameFile-name" class="input-group-text">Name</label>
                </div>
                <input type="text" id="renameFile-name" autocomplete="off" class="form-control col-sm-10"
                       formControlName="name">
            </div>
        </form>
    </c-modal-body>
    <c-modal-footer>
        <button type="button" class="btn btn-secondary" (click)="renameFileModal.visible = false">Close</button>
        <button type="submit" class="btn btn-primary" (click)="renameFile()"
                [disabled]="!renameFileForm.valid">Rename
        </button>
    </c-modal-footer>
</c-modal>

<c-modal #terminateSessionModal tabindex="-1" role="dialog"
         aria-labelledby="terminateSessionModal" aria-hidden="true">
    <c-modal-header>
        <h4 class="modal-title">Shut Down Kernel(s)</h4>
        <button type="button" class="close" (click)="terminateSessionModal.visible = false" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </c-modal-header>

    <c-modal-body>
        <form [formGroup]="terminateSessionForm" autocomplete="off" (submit)="terminateSession()">

            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <label class="input-group-text" for="terminate-session">Kernel</label>
                </div>
                <select class="form-control" formControlName="session" id="terminate-session">
                    @for (session of sessions; track session.id) {
                        <option [value]="session.id">
                            {{ session.kernel.name }}
                        </option>
                    }
                </select>
            </div>
        </form>
        @if (selectedSession != null) {
            <p>Status: {{ selectedSession.kernel.execution_state }}</p>
            <p>Last Activity: {{ selectedSession.kernel.last_activity | date: 'yyyy-MM-dd HH:mm:SS' }}</p>
            <p>Connections: {{ selectedSession.kernel.connections }}</p>
        }
    </c-modal-body>
    <c-modal-footer>
        <button type="button" class="btn btn-secondary" (click)="terminateSessionModal.visible = false">Cancel</button>
        <div class="btn-group pull-right" role="group">
            <button type="submit" class="btn btn-outline-danger" (click)="terminateSession()"
                    [disabled]="!terminateSessionForm.valid || deleting">Shut Down Selected
            </button>
            <button type="button" class="btn btn-danger" (click)="terminateAllSessions()"
                    [disabled]="deleting">
                Shut Down All
            </button>
        </div>
    </c-modal-footer>
</c-modal>

<c-modal #connectSessionModal tabindex="-1" role="dialog"
         aria-labelledby="connectSessionModal" aria-hidden="true">
    <c-modal-header>
        <h4 class="modal-title">Connect to Kernel</h4>
        <button type="button" class="close" (click)="connectSessionModal.visible = false" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </c-modal-header>

    <c-modal-body>
        <form [formGroup]="connectSessionForm" autocomplete="off" (submit)="connect()">

            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <label class="input-group-text" for="selected-session">Kernel</label>
                </div>
                <select class="form-control" formControlName="session" id="selected-session">
                    @for (session of sessions; track session.id) {
                        <option [value]="session.id">
                            {{ session.kernel.name }}
                        </option>
                    }
                </select>
            </div>
        </form>
        @if (selectedSession != null) {
            <p>Status: {{ selectedSession.kernel.execution_state }}</p>
            <p>Last Activity: {{ selectedSession.kernel.last_activity | date: 'yyyy-MM-dd HH:mm:SS' }}</p>
            <p>Connections: {{ selectedSession.kernel.connections }}</p>
        }
    </c-modal-body>
    <c-modal-footer>
        <button type="button" class="btn btn-secondary" (click)="connectSessionModal.visible = false">Cancel</button>
        <button type="submit" class="btn btn-primary" (click)="connect()"
                [disabled]="!connectSessionForm.valid">Connect
        </button>
    </c-modal-footer>
</c-modal>

<c-modal #createKernelModal tabindex="-1" role="dialog"
         aria-labelledby="createKernelModal" aria-hidden="true">
    <c-modal-header>
        <h4 class="modal-title">Create Kernel</h4>
        <button type="button" class="close" (click)="createKernelModal.visible = false" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </c-modal-header>

    <c-modal-body>
        <form [formGroup]="createKernelForm" autocomplete="off" (submit)="create()">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <label class="input-group-text" for="selected-kernel">Kernel</label>
                </div>
                <select class="form-control" formControlName="kernel" id="selected-kernel">
                    @for (kernel of availableKernels; track kernel.name) {
                        <option [value]="kernel.name">
                            {{ kernel.spec.display_name }}
                        </option>
                    }
                </select>
            </div>
        </form>
        <p>Language: {{ createKernelForm.get( 'kernel' ).value }}</p>
    </c-modal-body>
    <c-modal-footer>
        <button type="button" class="btn btn-secondary" (click)="createKernelModal.visible = false">Cancel</button>
        <button type="submit" class="btn btn-primary" (click)="create()"
                [disabled]="!createKernelForm.valid || creating">
            @if (!creating) {
                <span>Create</span>
            }
            @if (creating) {
                <span class="spinner-border spinner-border-sm" role="status"></span>
            }
        </button>
    </c-modal-footer>
</c-modal>
