<div class="activity-help">
    <markdown *ngIf="requiresMarkdown();else noMarkdown" class=""
              katex [katexOptions]="options"
              [data]="def().longDescription">
    </markdown>

    <ng-template #noMarkdown>
        <p>{{ def().longDescription }}</p>
    </ng-template>

    <div class="ports-section">
        <h4>Inputs</h4>
        <c-card class="mb-3">
            <ul cListGroup flush="true">
                @for (inPort of def().inPorts; track $index) {
                    <li cListGroupItem>
                        <h5>{{ $index }}:
                            <span class="text-medium-emphasis">{{ portTypeToDataModel( inPort.type ) }}</span>
                            <span *ngIf="inPort.isOptional" class="text-medium-emphasis"> (optional)</span>
                        </h5>
                        <markdown katex [katexOptions]="options" [data]="inPort.description"></markdown>
                    </li>
                }
            </ul>
        </c-card>

        <h4>Outputs</h4>
        <c-card class="mb-3">
            <ul cListGroup flush="true">
                @for (outPort of def().outPorts; track $index) {
                    <li cListGroupItem>
                        <h5>{{ $index }}:
                            <span class="text-medium-emphasis">{{ portTypeToDataModel( outPort.type ) }}</span>
                        </h5>
                        <markdown katex [katexOptions]="options" [data]="outPort.description"></markdown>
                    </li>
                }
            </ul>
        </c-card>
    </div>

    <div class="settings-section" *ngIf="activeSettingGroup()">
        <h4 [class]="{'mb-3': def().nonEmptyGroupCount <= 1}">Settings</h4>

        <ul class="nav nav-underline" role="tablist" *ngIf="def().nonEmptyGroupCount > 1">
            @for (group of def().groups; track group.key) {
                <li class="nav-item" role="presentation" *ngIf="!group.isEmpty">
                    <a class="nav-link"
                       [ngClass]="{'active': activeSettingGroup() === group}"
                       (click)="activeSettingGroup.set(group)"
                       role="tab">{{ group.displayName }}</a>
                </li>
            }
        </ul>

        @for (subgroup of activeSettingGroup().subgroups; track subgroup.key) {
            <ng-container *ngIf="!subgroup.isEmpty">
                <h5 *ngIf="!subgroup.isDefault() || true">{{ subgroup.displayName }}</h5>
                <c-card class="mb-3">
                    <ul cListGroup flush="true">
                        @for (setting of subgroup.settings; track setting.key) {
                            <li cListGroupItem>
                                <h6>{{ setting.displayName }}
                                    <span class="text-medium-emphasis">({{ setting.key }}: {{ setting.type }})</span>
                                </h6>
                                <markdown katex [katexOptions]="options" [data]="setting.longDescription"></markdown>
                            </li>
                        }
                    </ul>
                </c-card>
            </ng-container>
        }
    </div>
</div>
