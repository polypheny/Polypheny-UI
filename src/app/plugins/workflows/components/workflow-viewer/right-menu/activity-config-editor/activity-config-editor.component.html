<form cForm (ngSubmit)="saveConfig()" class="d-flex flex-column h-100">

    <div class="d-flex flex-row align-items-baseline">
        @if (hasConfigChanged()) {
            <span class="text-muted">Discard</span>
            <app-delete-confirm (delete)="resetConfig()"></app-delete-confirm>
        }

        <!-- Save Button -->
        <button class="ms-auto" cButton type="submit" color="primary" *ngIf="isEditable()"
                [disabled]="!hasConfigChanged()">
            Save
        </button>

    </div>

    <div class="config-inputs mt-2 flex-grow-1">
        <!-- Enforce Checkpoint -->
        <c-form-check [switch]="true" class="ms-1 mb-3">
            <label cFormCheckLabel for="form-check-input">Always create checkpoint</label>
            <input cFormCheckInput id="form-check-input" type="checkbox" [(ngModel)]="editableConfig().enforceCheckpoint"
                   name="form-check-input" (change)="checkForChanges()" [disabled]="!isEditable()">
        </c-form-check>


        <!-- Timeout-->
        <div class="mb-3">
            <label cLabel for="timeout">Execution timeout in seconds, or 0 to use workflow default</label>
            <input cFormControl type="number" id="timeout" [(ngModel)]="editableConfig().timeoutSeconds" name="timeout"
                   (change)="checkForChanges()" [disabled]="!isEditable()" min="0">
        </div>

        <!-- Preferred Stores -->
        <div class="mb-3">
            <label cLabel>Preferred Stores:</label>

            @for (outputStore of editableConfig().preferredStores; track i; let i = $index) {
                <c-input-group class="mb-3">
                    <label cInputGroupText for="preferred-{{i}}">{{ $first ? 'Output' : 'Output ' + i }}</label>
                    <select cSelect id="preferred-{{i}}" [(ngModel)]="editableConfig().preferredStores[i]" name="preferred-{{i}}"
                            (change)="checkForChanges()" [disabled]="!isEditable()">
                        <option [value]="''">Use workflow default</option>
                        <option *ngFor="let adapter of adapters()" [value]="adapter.name">{{ adapter.name + ' (' + adapter.adapterName + ')' }}</option>
                    </select>
                </c-input-group>
            }
        </div>

        <!-- Common Type -->
        <div class="mb-3">
            <label cLabel for="commonType">Common Transaction:</label>
            <select cSelect id="commonType" [(ngModel)]="editableConfig().commonType" name="commonType"
                    (change)="checkForChanges()" [disabled]="!isEditable()">
                <option *ngFor="let type of commonTypes" [value]="type">{{ type }}</option>
            </select>
            <div cFormText>
                Common transactions provide atomicity, consistency and isolation guarantees over multiple activities. Guarantees do not hold for activities with
                side-effects in external systems.
            </div>
        </div>

        <!-- Control State Merger -->
        <div class="mb-3">
            <label cLabel for="controlStateMerger">Control State Merger:</label>
            <select cSelect id="controlStateMerger" [(ngModel)]="editableConfig().controlStateMerger"
                    name="controlStateMerger" (change)="checkForChanges()" [disabled]="!isEditable()">
                <option *ngFor="let merger of controlStateMergers" [value]="merger">{{ merger }}</option>
            </select>
            <div cFormText>
                Determines whether the activity gets executed in case of multiple control edges. AND_AND means all control edges must be active.
                AND_OR means all success control edges must be active and at least one fail control edge.
            </div>
        </div>
    </div>
</form>

