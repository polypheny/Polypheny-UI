@if (casts()?.length > 0) {
    <c-card class="list-container border bg-light mb-2">
        <ul cListGroup flush="true">
            @for (cast of casts(); track $index) {
                <li cListGroupItem class="bg-white list-entry" [class.draggable]="isEditable()">
                    <c-row gutter=false>
                        <c-col [xs]="11" class="pe-0">
                            <div class="d-flex align-items-center">
                                @if (suggestions().length > 0) {
                                    <app-autocomplete (changed)="valueChanged()"
                                                      [data]="suggestions()"
                                                      [(value)]="cast.source"
                                                      [placeholder]="'Source ' + fieldType() | titlecase"
                                                      [disabled]="!isEditable()"
                                                      class="source-input">
                                    </app-autocomplete>
                                } @else {
                                    <input cFormControl sizing="sm" [placeholder]="fieldType() | titlecase"
                                           type="text" autocomplete="off" class="source-input"
                                           [(ngModel)]="cast.source" [disabled]="!isEditable()" (input)="valueChanged()">
                                }
                                @if (def().allowTarget) {
                                    <input cFormControl sizing="sm" id="cast-target" placeholder="Change Name"
                                           type="text" autocomplete="off" class="ms-1 target-input"
                                           [(ngModel)]="cast.target" [disabled]="!isEditable()" (input)="valueChanged()">
                                }
                            </div>
                            @if (!cast.asJson) {
                                <div class="d-flex mt-3 mb-1 align-items-center">
                                    <select cSelect sizing="sm" [(ngModel)]="cast.type" [disabled]="!isEditable()" (change)="valueChanged()">
                                        @for (t of types; track t.name) {
                                            <option [ngValue]="t.name">{{ t.name }}</option>
                                        }
                                    </select>
                                    <c-form-check [switch]="false" class="ms-2">
                                        <input cFormCheckInput id="nullable-cast" type="checkbox" [(ngModel)]="cast.nullable"
                                               name="nullable-cast" (change)="valueChanged()" [disabled]="!isEditable()">
                                        <label cFormCheckLabel for="nullable-cast">Nullable</label>
                                    </c-form-check>
                                </div>
                                @if (supportsPrecision()[$index] || supportsScale()[$index]) {
                                    <div class="d-flex mb-1 align-items-center">
                                        <!-- precision -->
                                        @if (supportsPrecision()[$index]) {
                                            <c-input-group sizing="sm" class="me-1">
                                                <span cInputGroupText>{{ precisionPlaceholder()[$index] }}</span>
                                                <input cFormControl [id]="'precision'+$index" type="number" [placeholder]="precisionPlaceholder()[$index]" [disabled]="!isEditable()"
                                                       [(ngModel)]="cast.precision" (change)="valueChanged()">
                                            </c-input-group>
                                        }
                                        <!-- scale -->
                                        @if (supportsScale()[$index]) {
                                            <c-input-group sizing="sm">
                                                <span cInputGroupText>scale</span>
                                                <input [id]="'scale'+$index" type="number" placeholder="scale" [disabled]="!isEditable()"
                                                       cFormControl [(ngModel)]="cast.scale" (change)="valueChanged()">
                                            </c-input-group>
                                        }
                                    </div>
                                }
                                <div class="d-flex mb-1 align-items-center">
                                    <select cSelect sizing="sm" name="collection_type" [disabled]="!isEditable()" (change)="valueChanged()" class="collection-type"
                                            [(ngModel)]="cast.collectionsType">
                                        <option value="">No Collection</option>
                                        <option value="ARRAY">ARRAY</option>
                                    </select>
                                    @if (cast.collectionsType === 'ARRAY') {
                                        <!-- dimension -->
                                        <c-input-group sizing="sm" class="ms-1">
                                            <span cInputGroupText>dim</span>
                                            <input cFormControl [id]="'dim'+$index" type="number" placeholder="dimension" [disabled]="!isEditable()"
                                                   [(ngModel)]="cast.dimension" (change)="valueChanged()">
                                        </c-input-group>
                                        <!-- cardinality -->
                                        <c-input-group sizing="sm" class="ms-1">
                                            <span cInputGroupText>card</span>
                                            <input [id]="'card'+$index" type="number" placeholder="cardinality" [disabled]="!isEditable()"
                                                   cFormControl [(ngModel)]="cast.cardinality" (change)="valueChanged()">
                                        </c-input-group>
                                    }
                                </div>
                            } @else {
                                @if (cast.asJson) {
                                    <span class="badge bg-secondary mt-2">
                                JSON
                              </span>
                                }
                            }
                        </c-col>
                        @if (isEditable() && !def().singleCast) {
                            <c-col [xs]="1" class="text-end p-0">
                                <app-delete-confirm (delete)="deleteCast($index)"></app-delete-confirm>
                            </c-col>
                        }
                    </c-row>
                </li>
            }
        </ul>
    </c-card>
}

@if (!def().singleCast && isEditable()) {
    <div class="d-flex" [class.justify-content-between]="def().allowJson">
        <div class="d-flex align-items-center">
            @if (suggestions().length > 0) {
                <app-autocomplete (changed)="valueChanged()"
                                  [data]="suggestions()"
                                  [(value)]="addName"
                                  [placeholder]="'Source ' + fieldType() | titlecase">
                </app-autocomplete>
            } @else {
                <input cFormControl sizing="sm" [placeholder]="fieldType() | titlecase"
                       type="text" autocomplete="off"
                       [(ngModel)]="addName" (input)="valueChanged()">
            }
            @if (def().allowJson) {
                <c-form-check [switch]="true" class="ms-2">
                    <input cFormCheckInput type="checkbox" [(ngModel)]="addAsJson"
                           id="allow-json-cast" (change)="valueChanged()">
                    <label cFormCheckLabel for="allow-json-cast">JSON</label>
                </c-form-check>
            }
        </div>
        <button cButton color="light" (click)="addCast()" size="sm" class="ms-2"
                [disabled]="addName.length < 1">
            Add {{ fieldType() | titlecase }}
        </button>
    </div>
}