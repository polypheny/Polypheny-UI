<c-input-group sizing="sm" class="mb-3">
    <label cInputGroupText for="selectMode">Mode</label>
    <select cSelect id="selectMode" [(ngModel)]="this.value().mode" (change)="valueChanged()"
            [disabled]="!isEditable()">
        <option *ngFor="let mode of modes" [value]="mode[0]">{{ mode[1] }}</option>
    </select>
</c-input-group>

<c-card class="list-container border bg-light mb-3" *ngIf="rules()?.length > 0">
    <ul cListGroup flush="true">
        @for (rule of rules(); track $index) {
            <li cListGroupItem class="bg-white list-entry" [class.draggable]="isEditable()">
                <c-row gutter=false>
                    <c-col [xs]="11">
                        <div class="d-flex mb-2 align-items-center justify-content-between">
                            @if (this.value().mode === 'CONSTANT') {
                                <div class="flex-grow-1">
                                    <app-autocomplete (changed)="valueChanged()"
                                                      [data]="suggestions()"
                                                      [(value)]="rule.source"
                                                      [placeholder]="fieldType()"
                                                      [disabled]="!isEditable()">
                                    </app-autocomplete>
                                </div>
                            } @else {
                                <input cFormControl sizing="sm" [placeholder]="this.value().mode === 'REGEX' ? 'input regex' : fieldType() + ' index'"
                                       type="text" autocomplete="off" [disabled]="!isEditable()" (input)="hasChanged.emit()"
                                       [(ngModel)]="rule.source" (change)="valueChanged()">
                            }
                            <c-form-check [switch]="true" *ngIf="this.value().mode !== 'INDEX'" class="ms-2 case-check">
                                <input cFormCheckInput type="checkbox" [disabled]="!isEditable()" (change)="valueChanged()"
                                       [(ngModel)]="rule.caseInsensitive"/>
                                <label cFormCheckLabel>Ignore case</label>
                            </c-form-check>
                        </div>
                        <div>
                            <input cFormControl sizing="sm" id="replacement" [placeholder]="'replacement'"
                                   type="text" autocomplete="off" [disabled]="!isEditable()" (input)="hasChanged.emit()"
                                   [(ngModel)]="rule.replacement" (change)="valueChanged()">
                        </div>
                    </c-col>
                    <c-col [xs]="1" class="text-end p-0" *ngIf="isEditable()">
                        <app-delete-confirm (delete)="deleteRule($index)"></app-delete-confirm>
                    </c-col>
                </c-row>
            </li>
        }
    </ul>

</c-card>

<button cButton color="light" *ngIf="isEditable()" (click)="addRule()" size="sm">
    Add Rule
</button>