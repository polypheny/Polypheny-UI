<c-input-group sizing="sm" class="mb-3">
    <label cInputGroupText for="selectMode">Mode</label>
    <select cSelect id="selectMode" [(ngModel)]="this.value().mode" (change)="valueChanged()"
            [disabled]="!isEditable()">
        @for (mode of modes(); track mode[0]) {
            <option [value]="mode[0]">{{ mode[1] }}</option>
        }
    </select>
</c-input-group>
@if (this.value().mode !== 'INDEX') {
    <c-input-group class="mb-3">
        <c-form-check [switch]="true">
            <input cFormCheckInput type="checkbox" [disabled]="!isEditable()" (change)="valueChanged()"
                   [(ngModel)]="this.value().ignoreCase"/>
            <label cFormCheckLabel>Ignore case</label>
        </c-form-check>
    </c-input-group>
}

@if (rules()?.length > 0) {
    <c-card class="list-container border bg-light mb-2">
        <ul cListGroup flush="true">
            @for (rule of rules(); track $index) {
                <li cListGroupItem class="bg-white list-entry" [class.draggable]="isEditable()">
                    <c-row gutter=false>
                        <c-col [xs]="11">
                            <div class="d-flex mb-1 align-items-center justify-content-between">
                                @if (this.value().mode === 'EXACT') {
                                    <div class="flex-grow-1">
                                        <app-autocomplete (changed)="valueChanged()"
                                                          [data]="suggestions()"
                                                          [(value)]="rule.source"
                                                          [placeholder]="fieldType() | titlecase"
                                                          [disabled]="!isEditable()">
                                        </app-autocomplete>
                                    </div>
                                } @else {
                                    <input cFormControl sizing="sm" [placeholder]="this.value().mode === 'REGEX' ? 'Search regex' : (fieldType() | titlecase) + ' index'"
                                           type="text" autocomplete="off" [disabled]="!isEditable()" (input)="hasChanged.emit()"
                                           [(ngModel)]="rule.source" (change)="valueChanged()">
                                }
                            </div>
                            <div>
                                <input cFormControl sizing="sm" id="replacement" [placeholder]="'Replace'"
                                       type="text" autocomplete="off" [disabled]="!isEditable()" (input)="hasChanged.emit()"
                                       [(ngModel)]="rule.replacement" (change)="valueChanged()">
                            </div>
                        </c-col>
                        @if (isEditable()) {
                            <c-col [xs]="1" class="text-end p-0">
                                <app-delete-confirm (delete)="deleteRule($index)"></app-delete-confirm>
                            </c-col>
                        }
                    </c-row>
                </li>
            }
        </ul>
    </c-card>
}

@if (isEditable()) {
    <button cButton color="light" (click)="addRule()" size="sm">
        Add Rule
    </button>
}