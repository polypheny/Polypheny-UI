@if (val()?.length > 0) {
    <c-card class="list-container border bg-light mb-3">
        <ul cListGroup cdkDropList (cdkDropListDropped)="drop($event)" flush="true">
            @for (agg of val(); track $index) {
                <li cListGroupItem cdkDrag [cdkDragDisabled]="!isEditable()" class="bg-white list-entry" [class.draggable]="isEditable()">
                    <c-row gutter=false>
                        <c-col [xs]="10">
                            <div class="d-flex mb-2 align-items-center">
                                <app-autocomplete (changed)="valueChanged()"
                                                  [data]="suggestions()"
                                                  [(value)]="agg.target"
                                                  [placeholder]="'target ' + fieldType()"
                                                  [disabled]="!isEditable()"
                                                  (mousedown)="$event.stopPropagation()">
                                </app-autocomplete>
                                <div class="ms-2">
                                    <input cFormControl sizing="sm" id="agg-alias" [placeholder]="'Alias (optional)'"
                                           type="text" autocomplete="off" [disabled]="!isEditable()" (input)="valueChanged()"
                                           [(ngModel)]="agg.alias">
                                </div>
                            </div>
                            <c-input-group sizing="sm">
                                <label cInputGroupText for="selectDir">Function</label>
                                <select cSelect id="selectDir" [(ngModel)]="agg.function" (change)="valueChanged()"
                                        [disabled]="!isEditable()" (mousedown)="$event.stopPropagation()">
                                    @for (choice of def().allowedFunctions; track choice) {
                                        <option [value]="choice">{{ displayFunctions[choice] }}</option>
                                    }
                                </select>
                            </c-input-group>
                        </c-col>
                        @if (isEditable()) {
                            <c-col [xs]="2" class="text-end p-0">
                                <app-delete-confirm (delete)="deleteField($index)" (mousedown)="$event.stopPropagation()"></app-delete-confirm>
                            </c-col>
                        }
                    </c-row>
                </li>
            }
        </ul>
    </c-card>
}

@if (isEditable()) {
    <button cButton color="light" (click)="addField()" size="sm">
        Add {{ fieldType() }}
    </button>
}