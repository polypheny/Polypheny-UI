<h1>Workflow Dashboard</h1>

<c-input-group class="mb-3">
    <input cFormControl placeholder="Workflow Name" [(ngModel)]="newWorkflowName"/>
    <button cButton color="primary" type="button" (click)="createAndOpenWorkflow()">
        Create Workflow
    </button>
</c-input-group>

<h2>Stored Workflows</h2>

<c-accordion class="mb-5">
    <ng-container *ngFor="let entry of sortedWorkflowDefs">
        <c-accordion-item #item="cAccordionItem" [visible]="false">
            <ng-template cTemplateId="accordionHeaderTemplate">
                <button (click)="item.toggleItem()" [collapsed]="!item.visible" cAccordionButton>
                    <h4>{{ entry.value.name }}</h4>
                </button>
            </ng-template>
            <ng-template cTemplateId="accordionBodyTemplate">
                <div class="accordion-body">
                    <div class="form-group">
                        <label for="versionSelect-{{entry.key}}"><strong>Version</strong></label>
                        <select id="versionSelect-{{entry.key}}" class="form-control" [(ngModel)]="selectedVersion[entry.key]">
                            <option *ngFor="let version of entry.value.versions | keyvalue" [value]="version.key">{{ version.key }}</option>
                        </select>
                    </div>

                    <div class="mt-3">
                        <div>
                            <strong>Description:</strong> {{ entry.value.versions[selectedVersion[entry.key]].description }}
                        </div>
                        <div>
                            <strong>Creation Time:</strong> {{ entry.value.versions[selectedVersion[entry.key]].creationTime | date:'short' }}
                        </div>

                        <button class="btn btn-primary mt-3" (click)="openVersion(entry.key)">
                            Open Version
                        </button>
                    </div>

                </div>
            </ng-template>
        </c-accordion-item>
    </ng-container>
</c-accordion>

<h2>Active Sessions</h2>
<ul cListGroup *ngIf="workflowDefs">
    <ng-container *ngFor="let session of sessions | keyvalue">
        <li cListGroupItem>
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong *ngIf="session.value.type === 'USER_SESSION'">
                        {{workflowDefs[session.value.workflowId].name}}
                        v{{session.value.version}}
                    </strong>
                    <strong *ngIf="session.value.type !== 'USER_SESSION'">
                        {{session.value.type}}
                    </strong>

                    <div>
                        <small><strong>SessionId:</strong> {{ session.value.sessionId }}</small><br/>
                        <small><strong>Connected Users:</strong> {{ session.value.connectionCount }}</small><br/>
                    </div>
                </div>
                <button class="btn btn-primary btn-sm" (click)="openSession(session.value.sessionId)">
                    Open
                </button>
            </div>
        </li>
    </ng-container>
</ul>
